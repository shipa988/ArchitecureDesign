# 3. reread-config-on-flight

Date: 2023-11-03

## Status

Принято

## Context

Задание со звездочкой*
КЕЙС.
Хочется иметь для разных сервисов возможность эти сервисы конфигурировать в реальном времени. Чтобы обновления подхватывались не только в момент рестарта из environment-переменых или конфигурационных файлов, но и в реалтайме.
Предполагается для этого использовать единое приложение - систему управления параметрами. Через веб-интерфейс можно изменить конфигурацию. После чего, не более чем через минуту эти изменения должны подхватываться читающими сервисами.
## Decision

| предложение                                                          | реализация                                                                                | плюсы                                                                                                                                                                                                                                                               | минусы                                                                                                                                                                                                                                                                                                                                                           |
|----------------------------------------------------------------------|-------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| использовать viper                                                   | https://github.com/spf13/viper#watching-and-re-reading-config-files                       | все сделано до нас и протестировано;<br/> если что-то не работает можно составить issue                                                                                                                                                                             | реализация и поддержка такой системы может потребовать дополнительных ресурсов и усилий;<br/>иногда могут измениться чувствительные данные в конфиге, например, подключение к бд и приложение переключится на другой репозиторий что может повлечь несогласованность данных;<br/>нужно обучать приложение такому перечитыванию, покрыть тестами сложные сценарии |
| прослушивании сигнала SIGHUP                                         | https://gist.github.com/andelf/5889946                                                    | работает прозрачно;<br/>                                                                                                                                                                                                                                            | те же; надо тестировать дополнительно                                                                                                                                                                                                                                                                                                                            |
| отказаться                                                           |                                                                                           | не надо выделять ресурсы на это на этапе mvp;<br/>не повлечет рассогласованности данных;<br/>не нужно усложнять сервисы, обучая их сложным сценариям (corner case);<br/>неправильные изменения параметров могут вызвать нестабильность или сбои в работе приложений | нет перечитывания параметров на лету                                                                                                                                                                                                                                                                                                                             |
| конфигурирование некоторых параметров в админке через изменение в БД | перечитывание ОПРЕДЕЛЕННЫХ параметров(проценты по контрактам, новые настройки валют и тп) | жестко определен перечень параметров которые вынесены для изменения в админку что исключит доступ к чувствительным параметрам хранящимся в конфиге или в env(пароли/адреса итп);<br/>не нужно доп реурсов-реализация админки уже заложена в план проекта;<br/>      | не все параметры подходят для вынесения в админку                                                                                                                                                                                                                                                                                                                |
|

## Consequences

Решено использовать админку как средство гибкого управления НЕКОТОРЫМИ параметрами. Список регулируемых параметров будет описан в BRD